--- arch/x86/kernel/kvm.c
+++ arch/x86/kernel/kvm.c
@@ -151,8 +151,6 @@
 		if (hlist_unhashed(&n.link))
 			break;
 
-		rcu_irq_exit();
-
 		if (!n.halted) {
 			local_irq_enable();
 			schedule();
@@ -161,11 +159,11 @@
 			/*
 			 * We cannot reschedule. So halt.
 			 */
+			rcu_irq_exit();
 			native_safe_halt();
 			local_irq_disable();
+			rcu_irq_enter();
 		}
-
-		rcu_irq_enter();
 	}
 	if (!n.halted)
 		finish_wait(&n.wq, &wait);
